<section class="players-page">
  <header class="players-header">
    <h1>Players</h1>
    <app-search (searchChanged)="onSearchChanged($event)"></app-search>
    <button class="btn-primary" routerLink="new">
      + Add Player
    </button>
  </header>

  @if (players().length) {
    <div class="players-list">
      @for (player of players(); track player) {
        <article
          class="player-card"
          (click)="goToDetail(player.id)"
          >
          @if (player.avatarUrl) {
            <img
              [src]="player.avatarUrl"
              alt="Avatar"
              class="avatar"
              />
          }
          <div class="player-info">
            <h2>{{ player.nickname }}</h2>
            <p>
              Level: {{ getPlayerLevel(getPlayerCompletedQuestsXp(player)).level }} ({{ getPlayerLevel(getPlayerCompletedQuestsXp(player)).title }})<br>
              XP: {{ getPlayerCompletedQuestsXp(player) }}
            </p>
            <div style="width:100%;background:#eee;border-radius:4px;height:12px;overflow:hidden;margin-bottom:4px">
              <div [style.width.%]="getLevelProgress(getPlayerCompletedQuestsXp(player)) * 100" style="background:#10b981;height:100%"></div>
            </div>
            @if (getXpToNextLevel(getPlayerCompletedQuestsXp(player)).nextLevel) {
              <p>
                Do ďalšieho levelu ({{ getXpToNextLevel(getPlayerCompletedQuestsXp(player)).nextLevel?.title }}):
                {{ getXpToNextLevel(getPlayerCompletedQuestsXp(player)).xpToNext }} XP
              </p>
            }
            @if (!getXpToNextLevel(getPlayerCompletedQuestsXp(player)).nextLevel) {
              <p>
                Maximálny level dosiahnutý!
              </p>
            }
            @if (player.clanId) {
              <p>
                Clan: <a [routerLink]="['/clans', player.clanId]" (click)="$event.stopPropagation()">
                {{ player.clanId }}
              </a>
            </p>
          } @else {
            <p>Clan: žiadny</p>
          }
          <p>Počet questov: {{ player.questIds.length }}</p>
        </div>
        <button
          class="btn-danger"
          (click)="removePlayer(player.id, $event)"
          >
          Delete
        </button>
      </article>
    }
  </div>
} @else {
  <p>Žiadni hráči. Skús pridať prvého cez „Add Player“.</p>
}

</section>